<script>
    window.NIVEL = "dominio-83f9x";
    window.DATA_DICAS = "../../data/dominio.json?v=22";
  </script>
  <script src="../../assets/js/drip.js?v=22" defer></script>
  <!-- ADICIONADO: cache-bust do JS da página -->
  <script src="./dicas-orientacoes.js?v=23" defer></script>

  <!-- Inline utilitário (já existia) -->
  <script>
  (function(){
    const $ = (s,r=document)=>r.querySelector(s);
    const peso=$('#t_peso'),altura=$('#t_altura'),idade=$('#t_idade'),sexo=$('#t_sexo');
    const fa=$('#pf_atividade'),obj=$('#pf_objetivo');
    const outTMB=$('#pf_tmb'),outTDEE=$('#pf_tdee'),outAlvo=$('#pf_kcal'),outProt=$('#pf_prot'),outGord=$('#pf_gord'),outCarb=$('#pf_carb');
    const num=v=>isFinite(+v)?+v:0; const round=v=>Math.round(v);
    function recalc(){
      const p=num(peso?.value),h=num(altura?.value),i=num(idade?.value);
      const sx=(sexo?.value||'f').toLowerCase(),fator=num(fa?.value)||1.55,objetivo=num(obj?.value)||0;
      if(!(p>0&&h>0&&i>0)){[outTMB,outTDEE,outAlvo,outProt,outGord,outCarb].forEach(o=>o.textContent='—');return;}
      const tmb=round((10*p)+(6.25*h)-(5*i)+(sx==='f'?-161:5));
      const tdee=round(tmb*fator);
      const alvo=round(tdee*(1+objetivo));
      const prot=round(2.0*p),gord=round(1.0*p);
      const carb=Math.max(0,round((alvo-(prot*4)-(gord*9))/4));
      outTMB.textContent=tmb+' kcal'; outTDEE.textContent=tdee+' kcal'; outAlvo.textContent=alvo+' kcal';
      outProt.textContent=prot+' g'; outGord.textContent=gord+' g'; outCarb.textContent=carb+' g';
    }
    ['input','change'].forEach(ev=>[peso,altura,idade,sexo,fa,obj].forEach(el=>el?.addEventListener(ev,recalc)));
    // ADICIONADO: primeiro cálculo para não parecer "inativo"
    recalc();
  })();
  </script>

  <!-- ADICIONADO: fallback ultra-leve para abas e calculadoras -->
  <script>
  (function(){
    try {
      // Se as abas não foram ligadas pelo JS externo, liga aqui.
      const tabs = document.querySelectorAll('.tab');
      const panels = document.querySelectorAll('.panel');
      if (tabs.length && panels.length) {
        const active = document.querySelector('.tab.active') || tabs[0];
        const act = (tb)=>{
          tabs.forEach(x=>x.classList.remove('active'));
          panels.forEach(p=>p.classList.remove('active'));
          tb.classList.add('active');
          const key = tb.dataset.tab;
          const panel = document.querySelector('#panel-' + key) || panels[0];
          panel.classList.add('active');
        };
        // Só adiciona se ainda não houver listener
        tabs.forEach(tb=>{
          tb._bpBound || tb.addEventListener('click', ()=>act(tb));
          tb._bpBound = true;
        });
        act(active);
      }

      // Se os botões Karvonen não tiverem listeners, instala aqui.
      const kId = document.querySelector('#k_idade');
      const kFr = document.querySelector('#k_fcr');
      const kOut= document.querySelector('#k_out');
      const kTbl= document.querySelector('#k_table');
      const kBtn= document.querySelector('#k_calcBtn');
      const kClr= document.querySelector('#k_clearBtn');
      if (kId && kFr && kOut && kTbl && kBtn && kClr && !kBtn._bpBound) {
        const karv = (fcMax, fcRep, frac)=> Math.round(((fcMax - fcRep)*frac)+fcRep);
        const build = (fcMax, fcRep)=>{
          const rows=[];
          for(let pct=50;pct<=80;pct+=5){
            rows.push(
              `<div class="row" style="justify-content:space-between">
                <span>${pct}% da FC de reserva</span><strong>${karv(fcMax,fcRep,pct/100)} bpm</strong>
               </div>`
            );
          }
          return rows.join('');
        };
        const calc=()=>{
          const a=+kId.value||0, r=+kFr.value||0;
          if(a<=0||r<=0){ kOut.textContent='Informe idade e FC de repouso.'; kTbl.innerHTML=''; return; }
          const fcMax = 220 - a;
          const alvo50 = karv(fcMax,r,0.50), alvo65 = karv(fcMax,r,0.65);
          kOut.innerHTML = `FC máx. estimada: <strong>${fcMax} bpm</strong><br><span class="small muted">Faixa sugerida (Fundação): ${alvo50}–${alvo65} bpm</span>`;
          kTbl.innerHTML = build(fcMax, r);
        };
        const clear=()=>{ kId.value=''; kFr.value=''; kOut.textContent='Informe idade e FC de repouso e clique em Calcular.'; kTbl.innerHTML=''; };
        kBtn.addEventListener('click', calc);
        kClr.addEventListener('click', clear);
        [kId,kFr].forEach(el=>el.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); calc(); }}));
        kBtn._bpBound = true;
      }

      // Se a TMB não tiver listeners, instala aqui e recalcula.
      const tP=document.querySelector('#t_peso');
      const tA=document.querySelector('#t_altura');
      const tI=document.querySelector('#t_idade');
      const tS=document.querySelector('#t_sexo');
      const tOut=document.querySelector('#t_out');
      if (tP && tA && tI && tS && tOut && !tP._bpBound) {
        const calc=()=>{
          const p=+tP.value||0, h=+tA.value||0, i=+tI.value||0, s=(tS.value||'f');
          if (p>0 && h>0 && i>0) {
            const base=Math.round((10*p)+(6.25*h)-(5*i)+(s==='f'?-161:5));
            tOut.innerHTML=`Sua TMB estimada: <strong>${base} kcal/dia</strong><br><span class="small muted">Autoconhecimento energético — não é um plano alimentar.</span>`;
          } else {
            tOut.textContent='Preencha peso, altura e idade.';
          }
        };
        ['input','change'].forEach(ev=>[tP,tA,tI,tS].forEach(el=>el.addEventListener(ev,calc)));
        calc();
        tP._bpBound = true;
      }
    } catch(e) {
      console.warn('fallback tools:', e);
    }
  })();
  </script>